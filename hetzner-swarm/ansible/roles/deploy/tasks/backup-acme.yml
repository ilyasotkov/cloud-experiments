- name: Check if acme.json is present locally
  local_action: stat path=../secrets/acme.json
  register: acme_file_exists_locally

- name: Create empty acme.json if not present
  when: not acme_file_exists_locally.stat.exists
  file:
    state: touch
    path: /acme.json
    mode: 0600

- name: Upload acme.json to remote server if exists locally but not on remote server
  when: acme_file_exists_locally.stat.exists
  copy:
    src: ../secrets/acme.json
    dest: /acme.json
    force: no
    mode: 0600
    decrypt: yes

- name: Update local copy of acme.json
  fetch:
    src: /acme.json
    dest: ../secrets/
    flat: yes
